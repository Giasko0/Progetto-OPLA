<style>

/*---------FORM---------*/
.popup-overlay {
  width: 100%;
  height: 100%;
  display: none; /* nascosto di default */
  position: fixed;
  top: 0;
  left: 0;
  align-items: center;
  justify-content: center;
  background-color: rgba(0,0,0,0.5);
  z-index: 100;
}

.popup {
  height: auto;
  max-height: 80vh;
  width: clamp(400px, 30vw, 600px);
  background: var(--color-white);
  border-radius: var(--radius);
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  overflow: auto;
}

.popup-header {
  background: #f2f2f2;
  padding: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.popup-header h2 {
  margin: 5px;
}

.popup-close {
  cursor: pointer;
  font-size: 2em;
}

.popup-content {
  padding: 20px;
  font-size: 1em;
}

.formEsame-label {
  width: 100%;
  display: block;
  margin-bottom: 5px;
}

.popup input,select,textarea {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  box-sizing: border-box;
}

.invia {
  padding: 10px 15px;
  cursor: pointer;
  margin: 20px auto;
  display: block;
}

#buttonOpzioniAvanzate {
  cursor: pointer;
  margin: 50px 0;
  font-size: 1.2em;
  color: var(--color-primary);
}

#opzioniAvanzate {
  display: none;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 15px;
  padding: 15px;
  background-color: #eee;
  border-radius: var(--radius);
}

#opzioniAvanzate label {
  margin-bottom: 5px;
}

#opzioniAvanzate select, #opzioniAvanzate input, #opzioniAvanzate textarea {
  padding: 8px;
  margin-bottom: 15px;
  box-sizing: border-box;
}

</style>

<div id="popupOverlay" class="popup-overlay">
  <div class="popup">
    <div class="popup-header">
      <h2>Inserisci un esame</h2>
      <span id="closeOverlay" class="popup-close">&times;</span>
    </div>

    <div class="popup-content">
      <form id="formEsame" method="POST" action="/flask/api/inserisciEsame">
        <p style="margin: 0; float: right">* Campi obbligatori</p>

        <!-- Hidden values -->
        <input type="text" id="docente" name="docente" hidden value="{{ request.cookies.get('username') }}"><!--Creare fun js per username-->
        <input type="text" id="annoAccademico" name="annoAccademico" hidden>

        <label class="formEsame-label" for="insegnamento">Insegnamento*</label>
        <select id="insegnamento" name="insegnamento">
          <option value="" disabled selected hidden>Scegli l'insegnamento</option>
        </select>

        <label class="formEsame-label" for="aula">Aula*</label>
        <select id="aula" name="aula" required></select>

        <label class="formEsame-label" for="dataora">Data*</label>
        <input type="date" id="dataora" name="dataora" readonly>

        <label class="formEsame-label" for="ora">Ora</label>
        <input type="time" id="ora" name="ora">

        <label class="formEsame-label" for="periodo">Periodo</label>
        <select id="periodo" name="periodo" required>
          <option value="" disabled selected hidden>Scegli il periodo</option>
          <option value="0">Mattina</option>
          <option value="1">Pomeriggio</option>
        </select>

        <span id="buttonOpzioniAvanzate">Opzioni avanzate &#x25BA;</span>

        <!-- Opzioni avanzate -->
        <div id="opzioniAvanzate">
          <div>
            <label class="formEsame-label" for="inizioIscrizione">Data inizio iscrizione</label>
            <input type="date" id="inizioIscrizione" name="inizioIscrizione"><!-- Funzione js per inizio/fine iscrizione-->  
          </div>

          <div>
            <label class="formEsame-label" for="fineIscrizione">Data fine iscrizione</label>
            <input type="date" id="fineIscrizione" name="fineIscrizione">
          </div>

          <div>
            <label class="formEsame-label" for="tipoEsame">Tipo esame</label>
            <select id="tipoEsame" name="tipoEsame">
              <option value="" disabled selected hidden>Scegli il tipo di esame</option>
              <option value="1">Scritto</option>
              <option value="2">Orale</option>
              <option value="3">Scritto e orale</option>
            </select>  
          </div>
          
          <div>
            <label class="formEsame-label" for="verbalizzazione">Verbalizzazione*</label>
            <select id="verbalizzazione" name="verbalizzazione">
              <option value="STD" selected>Standard</option>
              <option value="FWP">Firma doppia</option>
              <option value="FSS">Firma singola</option>
              <option value="PAR">Prova parziale</option>
              <option value="PPP">Prova parziale pubblica</option>
            </select>  
          </div>

          <div>
            <label class="formEsame-label" for="posti">Posti</label>
            <input type="number" id="posti" name="posti" min="1">  
          </div>

          <div>
            <label class="formEsame-label" for="note">Note</label>
            <textarea id="note" name="note" rows="2"></textarea>
          </div>

          <!--<div>
            <label class="formEsame-label" for="tipoAppello">Tipo appello</label>
            <select id="tipoAppello" name="tipoAppello">
              <option value="PF" selected>PF</option>
            </select>
          </div>
          <div>
            <label class="formEsame-label" for="riservato">Riservato</label>
            <input type="checkbox" id="riservato" name="riservato">  
          </div>
          <div>
            <label class="formEsame-label" for="definizioneAppello">Definizione appello</label>
            <select id="definizioneAppello" name="definizioneAppello">
              <option value="STD" selected>Standard</option>
            </select>
          </div>
          <div>
            <label class="formEsame-label" for="gestionePrenotazione">Gestione pren.</label>
            <select id="gestionePrenotazione" name="gestionePrenotazione">
              <option value="STD" selected>Standard</option>
            </select>  
          </div>-->
        </div>

        <button class="invia" type="submit">Invia</button>
      </form>

    </div>
  </div>
</div>

<script>
  // Chiude l'overlay al click della X
  document.getElementById('closeOverlay').addEventListener('click', function () {
    document.getElementById('popupOverlay').style.display = 'none';
  });

  // Chiude l'overlay se clicchi fuori dal form
  window.addEventListener('click', function (event) {
    if (event.target === document.getElementById('popupOverlay')) {
      document.getElementById('popupOverlay').style.display = 'none';
    }
  });
</script>