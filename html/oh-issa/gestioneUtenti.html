<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Gestione degli utenti del sistema OH-ISSA dell'Università degli Studi di Perugia. Assegna permessi amministrativi, visualizza e modifica gli account docenti.">
  <link rel="icon" type="image/x-icon" href="static/imgs/favicon.ico">
  <title>Gestione Utenti - OH-ISSA</title>
  <link rel="stylesheet" href="static/styles/admin.css">
  <script src="static/scripts/common.js"></script>
  <script src="static/scripts/authCheck.js"></script>
  <script src="static/scripts/navbarAdmin.js"></script>
  <script src="static/scripts/footerAdmin.js"></script>
  <script src="static/scripts/gestioneUtenti.js"></script>
</head>

<body>
  <div id="navbar"></div>

  <main>
    <h1>Gestione Utenti</h1>

    <section class="actions-bar">
      <div class="search-box">
        <input type="text" id="searchUser" placeholder="Cerca utente..." class="search-input">
      </div>
      <div class="actions-group">
        <button id="addUserBtn" class="btn primary">Aggiungi Utente</button>
        <div class="filter-options">
          <label>
            <input type="checkbox" id="showOnlyAdmins" class="filter-checkbox">
            Mostra solo amministratori
          </label>
        </div>
      </div>
    </section>

    <section class="users-section">
      <div class="table-container">
        <table id="usersTable" class="users-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Matricola</th>
              <th>Nome</th>
              <th>Cognome</th>
              <th>Permessi Admin</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody>
            <!-- I dati degli utenti verranno caricati qui dinamicamente dal JavaScript -->
          </tbody>
        </table>
      </div>

      <div id="loadingIndicator" class="loading-indicator">
        <span class="loading-text">Caricamento utenti...</span>
      </div>

      <div id="noUsersFound" class="no-results-message" style="display: none;">
        Nessun utente trovato con i criteri di ricerca attuali.
      </div>
    </section>

    <div id="responseMessages"></div>
  </main>

  <footer id="footer"></footer>

  <!-- Modal per la conferma dell'eliminazione -->
  <div id="deleteConfirmModal" class="modal">
    <div class="modal-content">
      <h2>Conferma Eliminazione</h2>
      <p>Sei sicuro di voler eliminare questo utente?</p>
      <p id="deleteUserInfo" class="important-text"></p>
      <p class="warning-text">Questa operazione non può essere annullata.</p>
      <div class="modal-actions">
        <button id="confirmDelete" class="btn danger">Elimina</button>
        <button id="cancelDelete" class="btn">Annulla</button>
      </div>
    </div>
  </div>
  
  <!-- Modal per la conferma dei permessi admin -->
  <div id="adminConfirmModal" class="modal">
    <div class="modal-content">
      <h2>Conferma Permessi Amministratore</h2>
      <p id="adminActionText">Sei sicuro di voler concedere i permessi di amministratore?</p>
      <p id="adminUserInfo" class="important-text"></p>
      <p class="warning-text">Gli amministratori hanno accesso completo alla gestione del sistema.</p>
      <div class="modal-actions">
        <button id="confirmAdmin" class="btn primary">Conferma</button>
        <button id="cancelAdmin" class="btn">Annulla</button>
      </div>
    </div>
  </div>

  <!-- Modale per l'aggiunta di un nuovo utente -->
  <div id="addUserModal" class="modal">
    <div class="modal-content">
      <h2>Aggiungi Nuovo Utente</h2>
      <form id="addUserForm">
        <div class="form-group">
          <label for="newUsername">Username di ateneo*</label>
          <input type="text" id="newUsername" name="username" required placeholder="es. ad020022">
        </div>
        <div class="form-group">
          <label for="newMatricola">Matricola U-GOV*</label>
          <input type="text" id="newMatricola" name="matricola" required placeholder="es. 011876">
        </div>
        <div class="form-group">
          <label for="newNome">Nome</label>
          <input type="text" id="newNome" name="nome" placeholder="Nome">
        </div>
        <div class="form-group">
          <label for="newCognome">Cognome</label>
          <input type="text" id="newCognome" name="cognome" placeholder="Cognome">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="newPermessiAdmin" name="permessi_admin">
            Permessi di amministratore
          </label>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">Aggiungi Utente</button>
          <button type="button" id="cancelAddUser" class="btn">Annulla</button>
        </div>
      </form>
    </div>
  </div>
</body>

</html>
