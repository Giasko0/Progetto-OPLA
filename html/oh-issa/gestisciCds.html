<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="static/imgs/favicon.ico">
  <title>Gestione CdS - OH-ISSA</title>
  <link rel="stylesheet" href="static/styles/admin.css">
  <script src="static/scripts/common.js"></script>
  <script src="static/scripts/authCheck.js"></script>
  <script src="static/scripts/navbarAdmin.js"></script>
  <script src="static/scripts/gestisciCds.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inizializza il form con anni accademici
      fetch('/api/getAnniAccademici')
        .then(response => response.json())
        .then(data => {
          const annoSelect = document.getElementById('anno_accademico');
          data.forEach(anno => {
            const option = document.createElement('option');
            option.value = anno;
            option.textContent = `${anno}/${anno+1}`;
            annoSelect.appendChild(option);
          });
        });
      
      // Carica elenco CdS esistenti
      loadCdSList();
    });
    
    function loadCdSList() {
      const container = document.getElementById('cdsContainer');
      container.innerHTML = "<p>Caricamento in corso...</p>";
      
      fetch('/api/getCdS')
        .then(response => response.json())
        .then(data => {
          if (data.length === 0) {
            container.innerHTML = "<p>Nessun corso di studi trovato.</p>";
            return;
          }
          
          const table = document.createElement('table');
          table.className = 'data-table';
          
          // Intestazione tabella
          const thead = document.createElement('thead');
          thead.innerHTML = `
            <tr>
              <th>Codice</th>
              <th>Nome</th>
              <th>Anno Accademico</th>
              <th>Azioni</th>
            </tr>`;
          table.appendChild(thead);
          
          // Corpo tabella
          const tbody = document.createElement('tbody');
          data.forEach(cds => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${cds.codice}</td>
              <td>${cds.nome_corso}</td>
              <td>${cds.anno_accademico}/${cds.anno_accademico+1}</td>
              <td>
                <button class="btn small" onclick="loadCdSDetails('${cds.codice}', ${cds.anno_accademico})">
                  Modifica
                </button>
              </td>`;
            tbody.appendChild(tr);
          });
          
          table.appendChild(tbody);
          container.innerHTML = '';
          container.appendChild(table);
        })
        .catch(error => {
          container.innerHTML = `<p>Errore durante il caricamento: ${error.message}</p>`;
        });
    }
  </script>
</head>

<body>
  <div id="navbar"></div>

  <main>
    <h1>Gestione Corsi di Studio</h1>

    <section class="form-section">
      <h2>Aggiungi/Modifica Corso di Studio</h2>

      <form id="cdsForm" action="/oh-issa/api/save-cds-dates" method="post">
        <!-- Informazioni generali -->
        <div class="form-group">
          <label for="codice">Codice CdS:</label>
          <input type="text" id="codice" name="codice" placeholder="Es. L062" required>

          <label for="anno_accademico">Anno Accademico:</label>
          <select id="anno_accademico" name="anno_accademico" required>
            <!-- Le opzioni saranno caricate dinamicamente -->
          </select>

          <label for="nome_corso">Nome Corso:</label>
          <input type="text" id="nome_corso" name="nome_corso" placeholder="Es. Informatica Triennale" required>

        </div>

        <!-- Primo semestre -->
        <fieldset>
          <legend>Primo Semestre</legend>

          <label for="inizio_lezioni_primo_semestre">Inizio lezioni:</label>
          <input type="date" id="inizio_lezioni_primo_semestre" name="inizio_lezioni_primo_semestre" required>

          <label for="fine_lezioni_primo_semestre">Fine lezioni:</label>
          <input type="date" id="fine_lezioni_primo_semestre" name="fine_lezioni_primo_semestre" required>

          <label for="pausa_didattica_primo_inizio">Inizio pausa didattica:</label>
          <input type="date" id="pausa_didattica_primo_inizio" name="pausa_didattica_primo_inizio">

          <label for="pausa_didattica_primo_fine">Fine pausa didattica:</label>
          <input type="date" id="pausa_didattica_primo_fine" name="pausa_didattica_primo_fine">
        </fieldset>

        <!-- Secondo semestre -->
        <fieldset>
          <legend>Secondo Semestre</legend>

          <label for="inizio_lezioni_secondo_semestre">Inizio lezioni:</label>
          <input type="date" id="inizio_lezioni_secondo_semestre" name="inizio_lezioni_secondo_semestre" required>

          <label for="fine_lezioni_secondo_semestre">Fine lezioni:</label>
          <input type="date" id="fine_lezioni_secondo_semestre" name="fine_lezioni_secondo_semestre" required>

          <label for="pausa_didattica_secondo_inizio">Inizio pausa didattica:</label>
          <input type="date" id="pausa_didattica_secondo_inizio" name="pausa_didattica_secondo_inizio">

          <label for="pausa_didattica_secondo_fine">Fine pausa didattica:</label>
          <input type="date" id="pausa_didattica_secondo_fine" name="pausa_didattica_secondo_fine">
        </fieldset>

        <!-- Sessioni d'esame -->
        <fieldset>
          <legend>Sessioni d'Esame</legend>

          <div class="session-group">
            <label for="inizio_sessione_anticipata">Inizio sessione anticipata:</label>
            <input type="date" id="inizio_sessione_anticipata" name="inizio_sessione_anticipata" required>

            <label for="fine_sessione_anticipata">Fine sessione anticipata:</label>
            <input type="date" id="fine_sessione_anticipata" name="fine_sessione_anticipata" required>
          </div>

          <div class="session-group">
            <label for="inizio_sessione_estiva">Inizio sessione estiva:</label>
            <input type="date" id="inizio_sessione_estiva" name="inizio_sessione_estiva" required>

            <label for="fine_sessione_estiva">Fine sessione estiva:</label>
            <input type="date" id="fine_sessione_estiva" name="fine_sessione_estiva" required>
          </div>

          <div class="session-group">
            <label for="inizio_sessione_autunnale">Inizio sessione autunnale:</label>
            <input type="date" id="inizio_sessione_autunnale" name="inizio_sessione_autunnale" required>

            <label for="fine_sessione_autunnale">Fine sessione autunnale:</label>
            <input type="date" id="fine_sessione_autunnale" name="fine_sessione_autunnale" required>
          </div>

          <div class="session-group">
            <label for="inizio_sessione_invernale">Inizio sessione invernale:</label>
            <input type="date" id="inizio_sessione_invernale" name="inizio_sessione_invernale" required>

            <label for="fine_sessione_invernale">Fine sessione invernale:</label>
            <input type="date" id="fine_sessione_invernale" name="fine_sessione_invernale" required>
          </div>
        </fieldset>

        <div class="actions">
          <button type="submit" class="btn primary">Salva</button>
          <button type="button" id="resetForm" class="btn">Reset</button>
        </div>
      </form>
    </section>

    <section class="list-section">
      <h2>Corsi di Studio Esistenti</h2>
      <div id="cdsContainer">
        <p>Caricamento in corso...</p>
      </div>
    </section>

    <div id="responseMessages"></div>
  </main>
</body>

</html>